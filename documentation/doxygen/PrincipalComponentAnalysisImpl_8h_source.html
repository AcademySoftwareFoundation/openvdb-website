<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>OpenVDB: openvdb/points/impl/PrincipalComponentAnalysisImpl.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenVDB
   &#160;<span id="projectnumber">12.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5862e09d5e9b1231151ba919eed3a485.html">openvdb</a></li><li class="navelem"><a class="el" href="dir_c9229911bfd1cba3327f6b216c5f36b0.html">points</a></li><li class="navelem"><a class="el" href="dir_f1837fd804c771cd6a6400b5e11ed687.html">impl</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">PrincipalComponentAnalysisImpl.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="PrincipalComponentAnalysisImpl_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright Contributors to the OpenVDB Project</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// SPDX-License-Identifier: MPL-2.0</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#ifndef OPENVDB_POINTS_POINT_PRINCIPAL_COMPONENT_ANALYSIS_IMPL_HAS_BEEN_INCLUDED</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#define OPENVDB_POINTS_POINT_PRINCIPAL_COMPONENT_ANALYSIS_IMPL_HAS_BEEN_INCLUDED</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">/// when enabled, prints timings for each substep of the PCA algorithm</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"></span><span class="preprocessor">#ifdef OPENVDB_PROFILE_PCA</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="openvdb_2openvdb_2util_2CpuTimer_8h.html">openvdb/util/CpuTimer.h</a>&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">/// @brief  Experimental option to skip storing the self weight for the</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">///   weighted PCA when set to 0</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">/// @todo  Decide what&#39;s more correct and remove this. Self contributions aren&#39;t</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">///   guaranteed with maxSourcePointsPerVoxel/maxTargetPointsPerVoxel</span></div><div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="PrincipalComponentAnalysisImpl_8h.html#a4614fc63143e1bdff7da82088c5275b8">   16</a></span>&#160;<span class="comment"></span><span class="preprocessor">#define OPENVDB_PCA_SELF_CONTRIBUTION 1</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceopenvdb.html">openvdb</a> {</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<a class="code" href="version_8h_8in.html#a2dde157791cd7558cdf886489256ba14">OPENVDB_USE_VERSION_NAMESPACE</a></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">namespace </span><a class="code" href="version_8h_8in.html#a00be3835cb8ad1ded8abd821fad20fc0">OPENVDB_VERSION_NAME</a> {</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">namespace </span>points {</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html">   23</a></span>&#160;<span class="keyword">namespace </span>pca_internal {</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#ifdef OPENVDB_PROFILE_PCA</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">using</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html">TimerT</a> = <a class="code" href="classopenvdb_1_1v12__1_1_1util_1_1CpuTimer.html">util::CpuTimer</a>;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html">   28</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html">NoTimer</a> {</div><div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html#ab4f590ac77fe187c9f10ccbf6290e6ea">   29</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html#ab4f590ac77fe187c9f10ccbf6290e6ea">start</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>*) {}</div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html#a8c528baf37154d347366083f0f816846">   30</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html#a8c528baf37154d347366083f0f816846">stop</a>() {}</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;};</div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a1c433791efd193de40ccd1e7bdb9ea95">   32</a></span>&#160;<span class="keyword">using</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html">TimerT</a> = <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html">NoTimer</a>;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html">   35</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html">PcaTimer</a> final : <span class="keyword">public</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html">TimerT</a></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;{</div><div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html#a8964920060c97fa9960e976160e532e9">   37</a></span>&#160;    <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html#a8964920060c97fa9960e976160e532e9">PcaTimer</a>(<a class="code" href="structopenvdb_1_1v12__1_1_1util_1_1NullInterrupter.html">util::NullInterrupter</a>* <span class="keyword">const</span> interrupt)</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        : <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html">TimerT</a>()</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        , mInterrupt(interrupt) {}</div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html#ab49c3d308464b470e74e80f608a72925">   40</a></span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html#ab49c3d308464b470e74e80f608a72925">start</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* msg)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        TimerT::start(msg);</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keywordflow">if</span> (mInterrupt) mInterrupt-&gt;start(msg);</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    }</div><div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html#a8c528baf37154d347366083f0f816846">   45</a></span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html#a8c528baf37154d347366083f0f816846">stop</a>()</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    {</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        TimerT::stop();</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        <span class="keywordflow">if</span> (mInterrupt) mInterrupt-&gt;end();</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    }</div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html#ab69fbad684042da90c1731572ef3739a">   50</a></span>&#160;    <a class="code" href="structopenvdb_1_1v12__1_1_1util_1_1NullInterrupter.html">util::NullInterrupter</a>* <span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html#ab69fbad684042da90c1731572ef3739a">mInterrupt</a>;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;};</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a18f7ed305c5f923b88fdd66718cbb679">   53</a></span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a18f7ed305c5f923b88fdd66718cbb679">WeightSumT</a> = double;</div><div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#aef0dd7cd7a370c4e165eb525ba4293e4">   54</a></span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#aef0dd7cd7a370c4e165eb525ba4293e4">WeightedPositionSumT</a> = Vec3d;</div><div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a39a6b84fbe901cd11124db01ed852617">   55</a></span>&#160;<span class="keyword">using</span> <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a39a6b84fbe901cd11124db01ed852617">GroupIndexT</a> = points::AttributeSet::Descriptor::GroupIndex;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html">   57</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html">AttrIndices</a></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;{</div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#a48cfd91afb5821f6fc06c08519a88c0d">   59</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#a48cfd91afb5821f6fc06c08519a88c0d">mPosSumIndex</a>;</div><div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#a96a4b8f632b5380b51aedc976d6bf952">   60</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#a96a4b8f632b5380b51aedc976d6bf952">mWeightSumIndex</a>;</div><div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#a0abe803363d9a241051a65f348672c2e">   61</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#a0abe803363d9a241051a65f348672c2e">mCovMatrixIndex</a>;</div><div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#a2fa6476b9adfe4d6e66b80dbb64b05cc">   62</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#a2fa6476b9adfe4d6e66b80dbb64b05cc">mPWsIndex</a>;</div><div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#ab656e3a99355a7187c65c98a1390e558">   63</a></span>&#160;    <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a39a6b84fbe901cd11124db01ed852617">GroupIndexT</a> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#ab656e3a99355a7187c65c98a1390e558">mEllipsesGroupIndex</a>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;};</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> LeafNodeT&gt;</div><div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a3f32fa658e09e0952c3763711968293a">   67</a></span>&#160;<span class="keyword">inline</span> T* <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a3f32fa658e09e0952c3763711968293a">initPcaArrayAttribute</a>(LeafNodeT&amp; leaf, <span class="keyword">const</span> <span class="keywordtype">size_t</span> idx, <span class="keyword">const</span> <span class="keywordtype">bool</span> fill = <span class="keyword">true</span>)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;{</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keyword">auto</span>&amp; array = leaf.attributeArray(idx);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a>(array.valueType() == typeNameAsString&lt;T&gt;());</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a>(array.codecType() == std::string(NullCodec::name()));</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    array.expand(fill); <span class="comment">// @note  does nothing if array is already not uniform</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* data = array.constDataAsByteArray();</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span>T*<span class="keyword">&gt;</span>(<span class="keyword">const_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(data));</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">/// @note The PCA transfer modules are broken into two separate steps, the</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">///   first which computes the weighted neighbourhoods of points and the second</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">///   which computes the covariance matrices. Both these steps perform an</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">///   identical loop over each points neighbourhood, with the second being</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">///   necessary to re-compute the exact positions and per position weights.</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">///   In theory, only a single loop is required; each point could instead</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">///   create and append a large list of the exact neighbourhood positions and</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">///   weights that impact it and use these to compute the covariance after the</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">///   first neighbourhood loop has completed (a true gather style approach).</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">///</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">///   The double loop technique was chosen to better handle the computation</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">///   of anisotropy for _all_ points and _all_ neighbourhoods (i.e. no limiting</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">///   via the max point per voxel (MPPV) options). It makes the PCA method</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">///   extremely memory efficient for _all_ MPPV and radius values. However</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">///   it might be worth falling back to a gather stlye approach when the MPPV</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">///   and radius values are relatively small. We should investigate this in the</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">///   future.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Po<span class="keywordtype">int</span>DataTreeT&gt;</div><div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html">   95</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html">PcaTransfer</a></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    : <span class="keyword">public</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1VolumeTransfer.html">VolumeTransfer</a>&lt;PointDataTreeT&gt;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    , <span class="keyword">public</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1InterruptableTransfer.html">InterruptableTransfer</a></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;{</div><div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#aab16788cbae95f37005d8fb45499f996">   99</a></span>&#160;    <span class="keyword">using</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1VolumeTransfer.html">BaseT</a> = <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1VolumeTransfer.html">VolumeTransfer&lt;PointDataTreeT&gt;</a>;</div><div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ac75c6baec61b7993e73761d50aa5c1a2">  100</a></span>&#160;    <span class="keyword">using</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ac75c6baec61b7993e73761d50aa5c1a2">LeafNodeType</a> = <span class="keyword">typename</span> PointDataTreeT::LeafNodeType;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// We know the codec is null as this works on the world space positions</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// that are temporarily computed for this algorithm</span></div><div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ab844de86504d34b00368de250bd597a3">  103</a></span>&#160;    <span class="keyword">using</span> <a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1AttributeHandle.html">PositionHandleT</a> = <a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1AttributeHandle.html">points::AttributeHandle&lt;Vec3d, NullCodec&gt;</a>;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a0d421a9a9585b892f618012d3fb2bc6d">  105</a></span>&#160;    <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a0d421a9a9585b892f618012d3fb2bc6d">PcaTransfer</a>(<span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html">AttrIndices</a>&amp; indices,</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                <span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html">PcaSettings</a>&amp; settings,</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> vs,</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                <a class="code" href="classopenvdb_1_1v12__1_1_1tree_1_1LeafManager.html">tree::LeafManager&lt;PointDataTreeT&gt;</a>&amp; manager,</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                <a class="code" href="structopenvdb_1_1v12__1_1_1util_1_1NullInterrupter.html">util::NullInterrupter</a>* interrupt)</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        : <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1VolumeTransfer.html">BaseT</a>(manager.tree())</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        , <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1InterruptableTransfer.html">InterruptableTransfer</a>(interrupt)</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        , mIndices(indices)</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        , mSettings(settings)</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        , mDxInv(1.0/vs)</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        , mManager(manager)</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        , mTargetPosition()</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        , mSourcePosition() {</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            <a class="code" href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a>(std::isfinite(mSettings.searchRadius));</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <a class="code" href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a>(std::isfinite(mDxInv));</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        }</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ab3a6665da196186afeebde1f5c57fe48">  122</a></span>&#160;    <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ab3a6665da196186afeebde1f5c57fe48">PcaTransfer</a>(<span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html">PcaTransfer</a>&amp; other)</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        : <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1VolumeTransfer.html">BaseT</a>(other)</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        , <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1InterruptableTransfer.html">InterruptableTransfer</a>(other)</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        , mIndices(other.mIndices)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        , mSettings(other.mSettings)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        , mDxInv(other.mDxInv)</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        , mManager(other.mManager)</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        , mTargetPosition()</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        , mSourcePosition() {}</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">    // This is no longer used but kept for reference; each axis iterations of</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">    // derived PCA methods uses this technique to skip voxels entirely if a</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">    // point&#39;s position and search radius does not intersect it</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">    static bool VoxelIntersectsSphere(const Coord&amp; ijk, const Vec3d&amp; PosIS, const Real r2)</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">    {</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">        const Vec3d min = ijk.asVec3d() - 0.5;</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">        const Vec3d max = ijk.asVec3d() + 0.5;</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">        Real dmin = 0;</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">        for (int i = 0; i &lt; 3; ++i) {</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">            if (PosIS[i] &lt; min[i])      dmin += math::Pow2(PosIS[i] - min[i]);</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">            else if (PosIS[i] &gt; max[i]) dmin += math::Pow2(PosIS[i] - max[i]);</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">        }</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">        return dmin &lt;= r2;</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a4366dd3b0170576a66f1d86d2658fe62">  150</a></span>&#160;    <span class="keywordtype">float</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a4366dd3b0170576a66f1d86d2658fe62">searchRadius</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mSettings.searchRadius; }</div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#aa82227fd25dcfb0f1433d99e7060fb9c">  151</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#aa82227fd25dcfb0f1433d99e7060fb9c">neighbourThreshold</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mSettings.neighbourThreshold; }</div><div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a3130b08485d61bf9b9d4052b3e39d000">  152</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a3130b08485d61bf9b9d4052b3e39d000">maxSourcePointsPerVoxel</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mSettings.maxSourcePointsPerVoxel; }</div><div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a813e941d4fd2616e1d8909d7cc551dc3">  153</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a813e941d4fd2616e1d8909d7cc551dc3">maxTargetPointsPerVoxel</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> mSettings.maxTargetPointsPerVoxel; }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a1c873216cd8998fa684d657246669220">  155</a></span>&#160;    <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#adf6e1d7d066bb09da957cc89f2b3ceb2">Vec3i</a> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a1c873216cd8998fa684d657246669220">range</a>(<span class="keyword">const</span> Coord&amp;, <span class="keywordtype">size_t</span>)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> this-&gt;<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a1c873216cd8998fa684d657246669220">range</a>(); }</div><div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a483ccde36f43eefafb7bf7aa794ce9fd">  156</a></span>&#160;    <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#adf6e1d7d066bb09da957cc89f2b3ceb2">Vec3i</a> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a483ccde36f43eefafb7bf7aa794ce9fd">range</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#adf6e1d7d066bb09da957cc89f2b3ceb2">Vec3i</a>(<a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#ac41d20efb3b21495b99555a27205127a">math::Round</a>(mSettings.searchRadius * mDxInv)); }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#afd0505e726ff74f5dfd542a322e1e17b">  158</a></span>&#160;    <span class="keyword">inline</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ac75c6baec61b7993e73761d50aa5c1a2">LeafNodeType</a>* <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#afd0505e726ff74f5dfd542a322e1e17b">initialize</a>(<span class="keyword">const</span> Coord&amp; origin, <span class="keyword">const</span> <span class="keywordtype">size_t</span> idx, <span class="keyword">const</span> CoordBBox&amp; bounds)</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    {</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <a class="code" href="namespaceopenvdb_1_1v12__1.html#a49c172664d07773fe108364eafe82942">BaseT::initialize</a>(origin, idx, bounds);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keyword">auto</span>&amp; leaf = mManager.leaf(idx);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        mTargetPosition = std::make_unique&lt;PositionHandleT&gt;(leaf.constAttributeArray(mIndices.mPWsIndex));</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">return</span> &amp;leaf;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a2fda99533133ac94b8a7915660757e7c">  166</a></span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a2fda99533133ac94b8a7915660757e7c">startPointLeaf</a>(<span class="keyword">const</span> <span class="keyword">typename</span> PointDataTreeT::LeafNodeType&amp; leaf)</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        mSourcePosition = std::make_unique&lt;PositionHandleT&gt;(leaf.constAttributeArray(mIndices.mPWsIndex));</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor">#if OPENVDB_PCA_SELF_CONTRIBUTION == 0</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        mIsSameLeaf = this-&gt;mTargetPosition-&gt;array() == this-&gt;mSourcePosition-&gt;array();</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#acd866270b26d80b767c92f50e7be5169">  175</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#acd866270b26d80b767c92f50e7be5169">endPointLeaf</a>(<span class="keyword">const</span> <span class="keyword">typename</span> PointDataTreeT::LeafNodeType&amp;) { <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keyword">protected</span>:</div><div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a5233bee6957e3e38f5d72e3f8bc6f8fd">  178</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html">AttrIndices</a>&amp; <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a5233bee6957e3e38f5d72e3f8bc6f8fd">mIndices</a>;</div><div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#aac50e5d581cbc7be4a5593ffe6a26522">  179</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html">PcaSettings</a>&amp; <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#aac50e5d581cbc7be4a5593ffe6a26522">mSettings</a>;</div><div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ac97026fa661761a4d56ff6c49aba8ad1">  180</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ac97026fa661761a4d56ff6c49aba8ad1">mDxInv</a>;</div><div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a79a005a4082d2b5640fa443033203f2b">  181</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="classopenvdb_1_1v12__1_1_1tree_1_1LeafManager.html">tree::LeafManager&lt;PointDataTreeT&gt;</a>&amp; <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a79a005a4082d2b5640fa443033203f2b">mManager</a>;</div><div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a998a45a7dbc5a1d5229895f76e49c4e6">  182</a></span>&#160;    std::unique_ptr&lt;PositionHandleT&gt; <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a998a45a7dbc5a1d5229895f76e49c4e6">mTargetPosition</a>;</div><div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ae2e7edab3832bc4e54e9268b5723957c">  183</a></span>&#160;    std::unique_ptr&lt;PositionHandleT&gt; <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ae2e7edab3832bc4e54e9268b5723957c">mSourcePosition</a>;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor">#if OPENVDB_PCA_SELF_CONTRIBUTION == 0</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordtype">bool</span> mIsSameLeaf {<span class="keyword">false</span>};</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;};</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Po<span class="keywordtype">int</span>DataTreeT&gt;</div><div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html">  190</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html">WeightPosSumsTransfer</a></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    : <span class="keyword">public</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html">PcaTransfer</a>&lt;PointDataTreeT&gt;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;{</div><div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a5702bcc5da2c9e0bbde9d922b9ef9682">  193</a></span>&#160;    <span class="keyword">using</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1VolumeTransfer.html">BaseT</a> = <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html">PcaTransfer&lt;PointDataTreeT&gt;</a>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a785cb9180680cc5b0dcb6efac36579c7">  195</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> DIM = PointDataTreeT::LeafNodeType::DIM;</div><div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#acbde5e0147479268c2f56863eb0c2775">  196</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> LOG2DIM = PointDataTreeT::LeafNodeType::LOG2DIM;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a9913a5174660f96cddb1f191b6e56769">  198</a></span>&#160;    <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a9913a5174660f96cddb1f191b6e56769">WeightPosSumsTransfer</a>(<span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html">AttrIndices</a>&amp; indices,</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                          <span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html">PcaSettings</a>&amp; settings,</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                          <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> vs,</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                          <a class="code" href="classopenvdb_1_1v12__1_1_1tree_1_1LeafManager.html">tree::LeafManager&lt;PointDataTreeT&gt;</a>&amp; manager,</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                          <a class="code" href="structopenvdb_1_1v12__1_1_1util_1_1NullInterrupter.html">util::NullInterrupter</a>* interrupt)</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        : <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1VolumeTransfer.html">BaseT</a>(indices, settings, vs, manager, interrupt)</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        , mWeights()</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        , mWeightedPositions()</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        , mCounts() {}</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a36cd9d8d389595554ee3e3fdc5764e50">  208</a></span>&#160;    <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a36cd9d8d389595554ee3e3fdc5764e50">WeightPosSumsTransfer</a>(<span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html">WeightPosSumsTransfer</a>&amp; other)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        : <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1VolumeTransfer.html">BaseT</a>(other)</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        , mWeights()</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        , mWeightedPositions()</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        , mCounts() {}</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a50581de5fbd80727b5379ec949b65fe9">  214</a></span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a50581de5fbd80727b5379ec949b65fe9">initialize</a>(<span class="keyword">const</span> Coord&amp; origin, <span class="keyword">const</span> <span class="keywordtype">size_t</span> idx, <span class="keyword">const</span> CoordBBox&amp; bounds)</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keyword">auto</span>&amp; leaf = (*<a class="code" href="namespaceopenvdb_1_1v12__1.html#a49c172664d07773fe108364eafe82942">BaseT::initialize</a>(origin, idx, bounds));</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        mWeights = initPcaArrayAttribute&lt;WeightSumT&gt;(leaf, this-&gt;mIndices.mWeightSumIndex);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        mWeightedPositions = initPcaArrayAttribute&lt;WeightedPositionSumT&gt;(leaf, this-&gt;mIndices.mPosSumIndex);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="comment">// track neighbours</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        mCounts.assign(this-&gt;mTargetPosition-&gt;size(), 0);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#af7ccddef0d121d14d6720cb0dd6296aa">  223</a></span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#af7ccddef0d121d14d6720cb0dd6296aa">rasterizePoints</a>(<span class="keyword">const</span> Coord&amp;, <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> start, <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> end, <span class="keyword">const</span> CoordBBox&amp; bounds)</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> step = <a class="code" href="namespaceopenvdb_1_1v12__1_1_1tools_1_1composite.html#a68b92f45fc81cfd68eee1b92eeb18a2d">std::max</a>(<a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a>(1), <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a>((end - start) / this-&gt;maxSourcePointsPerVoxel()));</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>* <span class="keyword">const</span> data = this-&gt;<span class="keyword">template</span> buffer&lt;0&gt;();</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mask = *(this-&gt;<span class="keyword">template</span> mask&lt;0&gt;());</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> searchRadiusInv = 1.0f / this-&gt;searchRadius();</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> searchRadius2 = <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(this-&gt;searchRadius());</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> searchRadiusIS2 = <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(this-&gt;searchRadius() * this-&gt;mDxInv);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <a class="code" href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a>(std::isfinite(searchRadiusInv));</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <a class="code" href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a>(std::isfinite(searchRadius2));</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <a class="code" href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a>(std::isfinite(searchRadiusIS2));</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keyword">const</span> Coord&amp; a(bounds.min());</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keyword">const</span> Coord&amp; b(bounds.max());</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> srcid = start; srcid &lt; end; srcid += step) {</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            <span class="keyword">const</span> Vec3d Psrc(this-&gt;mSourcePosition-&gt;get(srcid));</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="keyword">const</span> Vec3d PsrcIS = Psrc * this-&gt;mDxInv;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="keywordflow">for</span> (Coord c = a; c.x() &lt;= b.x(); ++c.x()) {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> minx = c.<a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html#af59136c0fb2c6ccc665bbc1c1f19a751">x</a>() - 0.5;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> maxx = c.x() + 0.5;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> dminx =</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                    (PsrcIS[0] &lt; minx ? <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(PsrcIS[0] - minx) :</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                    (PsrcIS[0] &gt; maxx ? <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(PsrcIS[0] - maxx) : 0));</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                <span class="keywordflow">if</span> (dminx &gt; searchRadiusIS2) <span class="keywordflow">continue</span>; <span class="comment">// next target voxel</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> i = ((c.x() &amp; (DIM-1u)) &lt;&lt; 2*LOG2DIM); <span class="comment">// unsigned bit shift mult</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                <span class="keywordflow">for</span> (c.y() = a.y(); c.y() &lt;= b.y(); ++c.y()) {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                    <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> miny = c.y() - 0.5;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                    <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> maxy = c.y() + 0.5;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> dminxy = dminx +</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                        (PsrcIS[1] &lt; miny ? <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(PsrcIS[1] - miny) :</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                        (PsrcIS[1] &gt; maxy ? <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(PsrcIS[1] - maxy) : 0));</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                    <span class="keywordflow">if</span> (dminxy &gt; searchRadiusIS2) <span class="keywordflow">continue</span>; <span class="comment">// next target voxel</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> ij = i + ((c.y() &amp; (DIM-1u)) &lt;&lt; LOG2DIM);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                    <span class="keywordflow">for</span> (c.z() = a.z(); c.z() &lt;= b.z(); ++c.z()) {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> offset = ij + <span class="comment">/*k*/</span>(c.z() &amp; (DIM-1u));</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                        <span class="keywordflow">if</span> (!mask.isOn(offset)) <span class="keywordflow">continue</span>; <span class="comment">// next target voxel</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> minz = c.z() - 0.5;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> maxz = c.z() + 0.5;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> dminxyz = dminxy +</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                            (PsrcIS[2] &lt; minz ? <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(PsrcIS[2] - minz) :</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                            (PsrcIS[2] &gt; maxz ? <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(PsrcIS[2] - maxz) : 0));</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                        <span class="comment">// Does this point&#39;s radius overlap the voxel c</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                        <span class="keywordflow">if</span> (dminxyz &gt; searchRadiusIS2) <span class="keywordflow">continue</span>; <span class="comment">// next target voxel</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                        <span class="comment">// src point overlaps voxel c</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> targetEnd = data[offset];</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> targetStart = (offset == 0) ? 0 : <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a>(data[offset - 1]);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> targetStep =</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                            <a class="code" href="namespaceopenvdb_1_1v12__1_1_1tools_1_1composite.html#a68b92f45fc81cfd68eee1b92eeb18a2d">std::max</a>(<a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a>(1), <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a>((targetEnd - targetStart) / this-&gt;maxTargetPointsPerVoxel()));</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">                        /// @warning  stepping in this way does not guarantee</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">                        ///   we get a self contribution, could guarantee this</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">                        ///   by enabling the OPENVDB_PCA_SELF_CONTRIBUTION == 0</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">                        ///   check and adding it afterwards.</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment"></span>                        <span class="keywordflow">for</span> (<a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> tgtid = targetStart; tgtid &lt; targetEnd; tgtid += targetStep) {</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="preprocessor">#if OPENVDB_PCA_SELF_CONTRIBUTION == 0</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="Platform_8h.html#aa7a931484d0bf4c15d597386de0ec0f6">OPENVDB_UNLIKELY</a>(this-&gt;mIsSameLeaf &amp;&amp; tgtid == srcid)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                            <span class="keyword">const</span> Vec3d Ptgt(this-&gt;mTargetPosition-&gt;get(tgtid));</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                            <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> d2 = (Psrc - Ptgt).lengthSqr();</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                            <span class="keywordflow">if</span> (d2 &gt; searchRadius2) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                            <span class="comment">// src point (srcid) reaches target point (tgtid)</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">float</span> weight = 1.0f - <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a3d91050fd959cebedf9a76ffaf59b29d">math::Pow3</a>(<span class="keywordtype">float</span>(<a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a8c76ed0355b788b047abae6370087b71">math::Sqrt</a>(d2)) * searchRadiusInv);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                            <a class="code" href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a>(weight &gt;= 0.0f &amp;&amp; weight &lt;= 1.0f);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                            mWeights[tgtid] += weight;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                            mWeightedPositions[tgtid] += Psrc * weight; <span class="comment">// @note: world space position is weighted</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                            ++mCounts[tgtid];</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                        }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                    }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                }</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            } <span class="comment">// outer sdf voxel</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        } <span class="comment">// point idx</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    }</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a066c0cf69ae4e5fb6d2271705422ebef">  305</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a066c0cf69ae4e5fb6d2271705422ebef">finalize</a>(<span class="keyword">const</span> Coord&amp;, <span class="keywordtype">size_t</span> idx)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="comment">// Add points to group with counts which are more than the neighbouring threshold</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keyword">auto</span>&amp; leaf = this-&gt;mManager.leaf(idx);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <span class="comment">// @todo add API to get the array from the group handle. The handle</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <span class="comment">//   calls loadData but not expand.</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="keyword">auto</span>&amp; array = leaf.attributeArray(this-&gt;mIndices.mEllipsesGroupIndex.first);</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            array.loadData(); <span class="comment">// so we can call setUnsafe/getUnsafe</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            array.expand();</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1GroupWriteHandle.html">points::GroupWriteHandle</a> group(leaf.groupWriteHandle(this-&gt;mIndices.mEllipsesGroupIndex));</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keyword">const</span> int32_t threshold = int32_t(this-&gt;neighbourThreshold());</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> i = 0; i &lt; this-&gt;mTargetPosition-&gt;size(); ++i) {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="comment">// turn points OFF if they are ON and don&#39;t meet max neighbour requirements</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <span class="keywordflow">if</span> ((threshold == 0 || (mCounts[i] &lt; threshold)) &amp;&amp; group.getUnsafe(i)) {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                group.setUnsafe(i, <span class="keyword">false</span>);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            }</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="keywordflow">if</span> (mCounts[i] &lt;= 0) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="comment">// Normalize weights</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <a class="code" href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a>(mWeights[i] &gt;= 0.0f);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            mWeights[i] = 1.0 / mWeights[i];</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            mWeightedPositions[i] *= mWeights[i];</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        }</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    }</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a18f7ed305c5f923b88fdd66718cbb679">WeightSumT</a>* mWeights;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#aef0dd7cd7a370c4e165eb525ba4293e4">WeightedPositionSumT</a>* mWeightedPositions;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    std::vector&lt;int32_t&gt; mCounts;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;};</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Po<span class="keywordtype">int</span>DataTreeT&gt;</div><div class="line"><a name="l00342"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html">  342</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html">CovarianceTransfer</a></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    : <span class="keyword">public</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html">PcaTransfer&lt;PointDataTreeT&gt;</a></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;{</div><div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#a5702bcc5da2c9e0bbde9d922b9ef9682">  345</a></span>&#160;    <span class="keyword">using</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1VolumeTransfer.html">BaseT</a> = <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html">PcaTransfer&lt;PointDataTreeT&gt;</a>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#a785cb9180680cc5b0dcb6efac36579c7">  347</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> DIM = PointDataTreeT::LeafNodeType::DIM;</div><div class="line"><a name="l00348"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#acbde5e0147479268c2f56863eb0c2775">  348</a></span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> LOG2DIM = PointDataTreeT::LeafNodeType::LOG2DIM;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#aa3c24766724130675ea92e3b062345ab">  350</a></span>&#160;    <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#aa3c24766724130675ea92e3b062345ab">CovarianceTransfer</a>(<span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html">AttrIndices</a>&amp; indices,</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                       <span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html">PcaSettings</a>&amp; settings,</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                       <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> vs,</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                       <a class="code" href="classopenvdb_1_1v12__1_1_1tree_1_1LeafManager.html">tree::LeafManager&lt;PointDataTreeT&gt;</a>&amp; manager,</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                       <a class="code" href="structopenvdb_1_1v12__1_1_1util_1_1NullInterrupter.html">util::NullInterrupter</a>* interrupt)</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        : <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1VolumeTransfer.html">BaseT</a>(indices, settings, vs, manager, interrupt)</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        , mInclusionGroupHandle()</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        , mWeights()</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        , mWeightedPositions()</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        , mCovMats() {}</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#aa949854ab9c2a1c71b223cd08d4e1166">  361</a></span>&#160;    <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#aa949854ab9c2a1c71b223cd08d4e1166">CovarianceTransfer</a>(<span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html">CovarianceTransfer</a>&amp; other)</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        : <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1VolumeTransfer.html">BaseT</a>(other)</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        , mInclusionGroupHandle()</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        , mWeights()</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        , mWeightedPositions()</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        , mCovMats() {}</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#a50581de5fbd80727b5379ec949b65fe9">  368</a></span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#a50581de5fbd80727b5379ec949b65fe9">initialize</a>(<span class="keyword">const</span> Coord&amp; origin, <span class="keyword">const</span> <span class="keywordtype">size_t</span> idx, <span class="keyword">const</span> CoordBBox&amp; bounds)</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keyword">auto</span>&amp; leaf = (*<a class="code" href="namespaceopenvdb_1_1v12__1.html#a49c172664d07773fe108364eafe82942">BaseT::initialize</a>(origin, idx, bounds));</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        mInclusionGroupHandle = std::make_unique&lt;points::GroupHandle&gt;(leaf.groupHandle(this-&gt;mIndices.mEllipsesGroupIndex));</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        mWeights = initPcaArrayAttribute&lt;WeightSumT&gt;(leaf, this-&gt;mIndices.mWeightSumIndex);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        mWeightedPositions = initPcaArrayAttribute&lt;WeightedPositionSumT&gt;(leaf, this-&gt;mIndices.mPosSumIndex);</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        mCovMats = initPcaArrayAttribute&lt;math::Mat3s&gt;(leaf, this-&gt;mIndices.mCovMatrixIndex);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#af7ccddef0d121d14d6720cb0dd6296aa">  377</a></span>&#160;    <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#af7ccddef0d121d14d6720cb0dd6296aa">rasterizePoints</a>(<span class="keyword">const</span> Coord&amp;, <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> start, <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> end, <span class="keyword">const</span> CoordBBox&amp; bounds)</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    {</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> step = <a class="code" href="namespaceopenvdb_1_1v12__1_1_1tools_1_1composite.html#a68b92f45fc81cfd68eee1b92eeb18a2d">std::max</a>(<a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a>(1), <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a>((end - start) / this-&gt;maxSourcePointsPerVoxel()));</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>* <span class="keyword">const</span> data = this-&gt;<span class="keyword">template</span> buffer&lt;0&gt;();</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mask = *(this-&gt;<span class="keyword">template</span> mask&lt;0&gt;());</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> searchRadiusInv = 1.0f/this-&gt;searchRadius();</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> searchRadius2 = <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(this-&gt;searchRadius());</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> searchRadiusIS2 = <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(this-&gt;searchRadius() * this-&gt;mDxInv);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <a class="code" href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a>(std::isfinite(searchRadiusInv));</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <a class="code" href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a>(std::isfinite(searchRadius2));</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <a class="code" href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a>(std::isfinite(searchRadiusIS2));</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keyword">const</span> Coord&amp; a(bounds.min());</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keyword">const</span> Coord&amp; b(bounds.max());</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> srcid = start; srcid &lt; end; srcid += step) {</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <span class="keyword">const</span> Vec3d Psrc(this-&gt;mSourcePosition-&gt;get(srcid));</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <span class="keyword">const</span> Vec3d PsrcIS = Psrc * this-&gt;mDxInv;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <span class="keywordflow">for</span> (Coord c = a; c.x() &lt;= b.x(); ++c.x()) {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> minx = c.<a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html#af59136c0fb2c6ccc665bbc1c1f19a751">x</a>() - 0.5;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> maxx = c.x() + 0.5;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> dminx =</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                    (PsrcIS[0] &lt; minx ? <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(PsrcIS[0] - minx) :</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                    (PsrcIS[0] &gt; maxx ? <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(PsrcIS[0] - maxx) : 0));</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                <span class="keywordflow">if</span> (dminx &gt; searchRadiusIS2) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> i = ((c.x() &amp; (DIM-1u)) &lt;&lt; 2*LOG2DIM); <span class="comment">// unsigned bit shift mult</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                <span class="keywordflow">for</span> (c.y() = a.y(); c.y() &lt;= b.y(); ++c.y()) {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                    <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> miny = c.y() - 0.5;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                    <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> maxy = c.y() + 0.5;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                    <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> dminxy = dminx +</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                        (PsrcIS[1] &lt; miny ? <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(PsrcIS[1] - miny) :</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                        (PsrcIS[1] &gt; maxy ? <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(PsrcIS[1] - maxy) : 0));</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                    <span class="keywordflow">if</span> (dminxy &gt; searchRadiusIS2) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                    <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> ij = i + ((c.y() &amp; (DIM-1u)) &lt;&lt; LOG2DIM);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                    <span class="keywordflow">for</span> (c.z() = a.z(); c.z() &lt;= b.z(); ++c.z()) {</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> offset = ij + <span class="comment">/*k*/</span>(c.z() &amp; (DIM-1u));</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                        <span class="keywordflow">if</span> (!mask.isOn(offset)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> minz = c.z() - 0.5;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> maxz = c.z() + 0.5;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> dminxyz = dminxy +</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                            (PsrcIS[2] &lt; minz ? <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(PsrcIS[2] - minz) :</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                            (PsrcIS[2] &gt; maxz ? <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">math::Pow2</a>(PsrcIS[2] - maxz) : 0));</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                        <span class="comment">// Does this point&#39;s radius overlap the voxel c</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                        <span class="keywordflow">if</span> (dminxyz &gt; searchRadiusIS2) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> targetEnd = data[offset];</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> targetStart = (offset == 0) ? 0 : <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a>(data[offset - 1]);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> targetStep =</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                            <a class="code" href="namespaceopenvdb_1_1v12__1_1_1tools_1_1composite.html#a68b92f45fc81cfd68eee1b92eeb18a2d">std::max</a>(<a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a>(1), <a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a>((targetEnd - targetStart) / this-&gt;maxTargetPointsPerVoxel()));</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                        <span class="keywordflow">for</span> (<a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> tgtid = targetStart; tgtid &lt; targetEnd; tgtid += targetStep) {</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                            <span class="keywordflow">if</span> (!mInclusionGroupHandle-&gt;get(tgtid)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="preprocessor">#if OPENVDB_PCA_SELF_CONTRIBUTION == 0</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="Platform_8h.html#aa7a931484d0bf4c15d597386de0ec0f6">OPENVDB_UNLIKELY</a>(this-&gt;mIsSameLeaf &amp;&amp; tgtid == srcid)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                            <span class="keyword">const</span> Vec3d Ptgt(this-&gt;mTargetPosition-&gt;get(tgtid));</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                            <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">Real</a> d2 = (Psrc - Ptgt).lengthSqr();</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                            <span class="keywordflow">if</span> (d2 &gt; searchRadius2) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                            <span class="comment">// @note  I&#39;ve observed some performance degradation if</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                            <span class="comment">//   we don&#39;t take copies of the buffers here (aliasing?)</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                            <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a18f7ed305c5f923b88fdd66718cbb679">WeightSumT</a> totalWeightInv = mWeights[tgtid];</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                            <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#aef0dd7cd7a370c4e165eb525ba4293e4">WeightedPositionSumT</a> currWeightSum = mWeightedPositions[tgtid];</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                            <span class="comment">// re-compute weight</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                            <span class="comment">// @note  A gather style approach might be better,</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                            <span class="comment">//   where each point appends weights/positions into</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                            <span class="comment">//   a container. We lose some time having to re-</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                            <span class="comment">//   iterate, but this is far more memory efficient.</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                            <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a18f7ed305c5f923b88fdd66718cbb679">WeightSumT</a> weight = 1.0f - <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a3d91050fd959cebedf9a76ffaf59b29d">math::Pow3</a>(<span class="keywordtype">float</span>(<a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a8c76ed0355b788b047abae6370087b71">math::Sqrt</a>(d2)) * searchRadiusInv);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                            <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#aef0dd7cd7a370c4e165eb525ba4293e4">WeightedPositionSumT</a> posMeanDiff = Psrc - currWeightSum;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                            <span class="comment">// @note  Could extract the mult by totalWeightInv</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                            <span class="comment">//   and put it into a loop in finalize() - except</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                            <span class="comment">//   it would be mat3*float rather than vec*float,</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                            <span class="comment">//   which would probably better as maxppv increases</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                            <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#aef0dd7cd7a370c4e165eb525ba4293e4">WeightedPositionSumT</a> x = (totalWeightInv * weight) * posMeanDiff;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                            <span class="keywordtype">float</span>* <span class="keyword">const</span> m = mCovMats[tgtid].asPointer();<span class="comment"></span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">                            /// @note: equal to:</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment"></span>                            <span class="comment">// mat.setCol(0, mat.col(0) + (x * posMeanDiff[0]));</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                            <span class="comment">// mat.setCol(1, mat.col(1) + (x * posMeanDiff[1]));</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                            <span class="comment">// mat.setCol(2, mat.col(2) + (x * posMeanDiff[2]));</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                            <span class="comment">// @todo formalize precision of these methods</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                            m[0] += float(x[0] * posMeanDiff[0]);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                            m[1] += float(x[0] * posMeanDiff[1]);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                            m[2] += float(x[0] * posMeanDiff[2]);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                            <span class="comment">//</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                            m[3] += float(x[1] * posMeanDiff[0]);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                            m[4] += float(x[1] * posMeanDiff[1]);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                            m[5] += float(x[1] * posMeanDiff[2]);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                            <span class="comment">//</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                            m[6] += float(x[2] * posMeanDiff[0]);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                            m[7] += float(x[2] * posMeanDiff[1]);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                            m[8] += float(x[2] * posMeanDiff[2]);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                        } <span class="comment">//point idx</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                    }</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                }</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            } <span class="comment">// outer sdf voxel</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        } <span class="comment">// point idx</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    }</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno"><a class="line" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#a6908fe788ccb493a3e864ff725b95b21">  483</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#a6908fe788ccb493a3e864ff725b95b21">finalize</a>(<span class="keyword">const</span> Coord&amp;, <span class="keywordtype">size_t</span>) { <span class="keywordflow">return</span> <span class="keyword">true</span>; }</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1GroupHandle.html#a57b4be157b07a61dd2236638e5288d88">points::GroupHandle::UniquePtr</a> mInclusionGroupHandle;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a18f7ed305c5f923b88fdd66718cbb679">WeightSumT</a>* mWeights;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#aef0dd7cd7a370c4e165eb525ba4293e4">WeightedPositionSumT</a>* mWeightedPositions;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Mat3.html">math::Mat3s</a>* mCovMats;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    std::vector&lt;int32_t&gt; mCounts;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;};</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">/// @brief Sort a vector into descending order and output a vector of the resulting order</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">/// @param vector Vector to sort</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Scalar&gt;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="keyword">inline</span> <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#adf6e1d7d066bb09da957cc89f2b3ceb2">Vec3i</a></div><div class="line"><a name="l00497"></a><span class="lineno"><a class="line" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a6d253f8e6189aafd7ce00d3bb20bfd3b">  497</a></span>&#160;<a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a6d253f8e6189aafd7ce00d3bb20bfd3b">descendingOrder</a>(<a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html">math::Vec3&lt;Scalar&gt;</a>&amp; vector)</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;{</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#adf6e1d7d066bb09da957cc89f2b3ceb2">Vec3i</a> order(0,1,2);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">if</span> (vector[0] &lt; vector[1]) {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        std::swap(vector[0], vector[1]);</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        std::swap(order[0], order[1]);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">if</span> (vector[1] &lt; vector[2]) {</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        std::swap(vector[1], vector[2]);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        std::swap(order[1], order[2]);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">if</span> (vector[0] &lt; vector[1]) {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        std::swap(vector[0], vector[1]);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        std::swap(order[0], order[1]);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    }</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">return</span> order;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;}</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">/// @brief Decomposes a symmetric matrix into its eigenvalues and a rotation matrix of eigenvectors.</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">///        Note that if mat is positive-definite, this will be equivalent to a singular value</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">///        decomposition where V = U.</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">/// @param mat Matrix to decompose</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">/// @param U rotation matrix.  The order of its columns (which will be eigenvectors) will match</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">///          the eigenvalues in sigma</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">/// @param sigma vector of eigenvalues</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Scalar&gt;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">bool</span></div><div class="line"><a name="l00524"></a><span class="lineno"><a class="line" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a59dbbaecb7b917744a0f177dc5cf9085">  524</a></span>&#160;<a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a59dbbaecb7b917744a0f177dc5cf9085">decomposeSymmetricMatrix</a>(<span class="keyword">const</span> <a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Mat3.html">math::Mat3&lt;Scalar&gt;</a>&amp; mat,</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                         <a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Mat3.html">math::Mat3&lt;Scalar&gt;</a>&amp; U,</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                         <a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html">math::Vec3&lt;Scalar&gt;</a>&amp; sigma)</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;{</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Mat3.html">math::Mat3&lt;Scalar&gt;</a> Q;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> diagonalized = <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a25bd68ea05f64fc7e9fba6cb76eab539">math::diagonalizeSymmetricMatrix</a>(mat, Q, sigma);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">if</span> (!diagonalized) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="comment">// need to sort eigenvalues and eigenvectors</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#adf6e1d7d066bb09da957cc89f2b3ceb2">Vec3i</a> order = <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a6d253f8e6189aafd7ce00d3bb20bfd3b">descendingOrder</a>(sigma);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="comment">// we need to re-order the matrix (&quot;Q&quot;) columns to match the new eigenvalue order</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="comment">// to obtain the correct &quot;U&quot; matrix</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    U.<a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Mat3.html#af08e6152df053fe8980d55e7ccf607fd">setColumns</a>(Q.<a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Mat3.html#a0be7ef8d3fb41427f942546f4745e5ac">col</a>(order[0]), Q.<a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Mat3.html#a0be7ef8d3fb41427f942546f4745e5ac">col</a>(order[1]), Q.<a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Mat3.html#a0be7ef8d3fb41427f942546f4745e5ac">col</a>(order[2]));</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;}</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;} <span class="comment">// namespace pca_internal</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Po<span class="keywordtype">int</span>DataGr<span class="keywordtype">id</span>T&gt;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span></div><div class="line"><a name="l00548"></a><span class="lineno"><a class="line" href="namespaceopenvdb_1_1v12__1_1_1points.html#a74fa733452dea2d0ee1d99c9583fd30d">  548</a></span>&#160;<a class="code" href="namespaceopenvdb_1_1v12__1_1_1points.html#a74fa733452dea2d0ee1d99c9583fd30d">pca</a>(PointDataGridT&amp; points,</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html">PcaSettings</a>&amp; settings,</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keyword">const</span> <a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes.html">PcaAttributes</a>&amp; attrs)</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;{</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    static_assert(<a class="code" href="structopenvdb_1_1v12__1_1_1IsSpecializationOf.html">IsSpecializationOf&lt;PointDataGridT, Grid&gt;::value</a>);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keyword">using namespace </span>pca_internal;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keyword">using</span> PointDataTreeT = <span class="keyword">typename</span> PointDataGridT::TreeType;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keyword">using</span> LeafManagerT = <a class="code" href="classopenvdb_1_1v12__1_1_1tree_1_1LeafManager.html">tree::LeafManager&lt;PointDataTreeT&gt;</a>;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keyword">using</span> LeafNodeT = <span class="keyword">typename</span> PointDataTreeT::LeafNodeType;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keyword">auto</span>&amp; tree = points.<a class="code" href="classopenvdb_1_1v12__1_1_1tree_1_1LeafManager.html#a932dc28aa53e3961b2c4f8b3ff4c7242">tree</a>();</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> leaf = tree.cbeginLeaf();</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">if</span> (!leaf) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="comment">// Small lambda to init any one of the necessary ellipsoid attributes</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="comment">// @note  Various algorithms here assume that we are responsible for creating</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="comment">//   these attributes and so can optimize accordingly. If this changes we&#39;ll</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="comment">//   need to also change those optimizations (e.g. NullCodec, loadData, etc)</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> initAttribute = [&amp;](<span class="keyword">const</span> std::string&amp; name, <span class="keyword">const</span> <span class="keyword">auto</span> val)</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="keyword">using</span> ValueT = std::decay_t&lt;decltype(val)&gt;;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="keywordflow">if</span> (leaf-&gt;hasAttribute(name)) {</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            <a class="code" href="openvdb_2Exceptions_8h.html#a3eec2ef3138c64fc5844490187c1b8d1">OPENVDB_THROW</a>(<a class="code" href="classopenvdb_1_1v12__1_1_1KeyError.html">KeyError</a>, <span class="stringliteral">&quot;PCA attribute &#39;&quot;</span>  &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;&#39; already exists!&quot;</span>);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        }</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        points::appendAttribute&lt;ValueT&gt;(tree, name, val);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordflow">return</span> leaf-&gt;attributeSet().find(name);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    };</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> pvsIdx = leaf-&gt;attributeSet().find(<span class="stringliteral">&quot;P&quot;</span>);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; xform = points.constTransform();</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> vs = xform.voxelSize()[0];</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    LeafManagerT manager(tree);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="comment">// 1) Create persisting attributes</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> pwsIdx = initAttribute(attrs.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes.html#a22dd239b885254df215c9f4d613102a5">positionWS</a>, zeroVal&lt;PcaAttributes::PosWsT&gt;());</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> rotIdx = initAttribute(attrs.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes.html#a020a5ed16757011c234ad22ec7d3e20b">rotation</a>, zeroVal&lt;PcaAttributes::RotationT&gt;());</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> strIdx = initAttribute(attrs.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes.html#a713f968f2be98263546ec2b16f184f78">stretch</a>, <a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html">PcaAttributes::StretchT</a>(settings.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#ad600459e92dde7f0856f77c19d8c5af0">nonAnisotropicStretch</a>));</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="comment">// 2) Create temporary attributes</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; descriptor = leaf-&gt;attributeSet().descriptor();</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keyword">const</span> std::vector&lt;std::string&gt; temps {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        descriptor.uniqueName(<span class="stringliteral">&quot;_weightedpositionsums&quot;</span>),</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        descriptor.uniqueName(<span class="stringliteral">&quot;_inv_weightssum&quot;</span>)</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    };</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> posSumIndex = initAttribute(temps[0], zeroVal&lt;WeightedPositionSumT&gt;());</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> weightSumIndex = initAttribute(temps[1], zeroVal&lt;WeightSumT&gt;());</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="comment">// 3) Create ellipses group</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordflow">if</span> (!leaf-&gt;attributeSet().descriptor().hasGroup(attrs.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes.html#a2df625cb603c09330b44d1328efdbb50">ellipses</a>)) {</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points.html#a6df5f0462ae9d328e4987971cda4c7ee">points::appendGroup</a>(tree, attrs.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes.html#a2df625cb603c09330b44d1328efdbb50">ellipses</a>);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="comment">// Include everything by default to start with</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points.html#a1866ee320dd051901bb7f4f49e155cee">points::setGroup</a>(tree, attrs.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes.html#a2df625cb603c09330b44d1328efdbb50">ellipses</a>, <span class="keyword">true</span>);</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    }</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="comment">// Re-acquire the updated descriptor and get the group idx</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a39a6b84fbe901cd11124db01ed852617">GroupIndexT</a> ellipsesIdx =</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        leaf-&gt;attributeSet().descriptor().groupIndex(attrs.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes.html#a2df625cb603c09330b44d1328efdbb50">ellipses</a>);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    PcaTimer timer(settings.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#aa6e12ee62c3d8342922237cb08a8a6ae">interrupter</a>);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">// 3) Store the world space position on the PDG to speed up subsequent</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="comment">//    calculations.</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    timer.start(<span class="stringliteral">&quot;Compute position world spaces&quot;</span>);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    manager.foreach([&amp;](LeafNodeT&amp; leafnode, <span class="keywordtype">size_t</span>)</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keyword">using</span> PvsT = <a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html">Vec3f</a>;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keyword">using</span> PwsT = <a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html">PcaAttributes::PosWsT</a>;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1AttributeHandle.html">points::AttributeHandle&lt;PvsT&gt;</a> Pvs(leafnode.constAttributeArray(pvsIdx));</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        PwsT* Pws = initPcaArrayAttribute&lt;PwsT&gt;(leafnode, pwsIdx, <span class="comment">/*fill=*/</span><span class="keyword">false</span>);</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> voxel = leafnode.cbeginValueOn(); voxel; ++voxel) {</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            <span class="keyword">const</span> Coord voxelCoord = voxel.getCoord();</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            <span class="keyword">const</span> Vec3d coordVec = voxelCoord.asVec3d();</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">auto</span> iter = leafnode.beginIndexVoxel(voxelCoord); iter; ++iter) {</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                Pws[*iter] = xform.indexToWorld(Pvs.get(*iter) + coordVec);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            }</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        }</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    });</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    timer.stop();</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceopenvdb_1_1v12__1_1_1util.html#a7783bf79cc10a02b50848680938e1a74">util::wasInterrupted</a>(settings.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#aa6e12ee62c3d8342922237cb08a8a6ae">interrupter</a>)) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    AttrIndices indices;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    indices.mPosSumIndex = posSumIndex;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    indices.mWeightSumIndex = weightSumIndex;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    indices.mCovMatrixIndex = rotIdx;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    indices.mPWsIndex = pwsIdx;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    indices.mEllipsesGroupIndex = ellipsesIdx;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="comment">// 4) Init temporary attributes and calculate:</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <span class="comment">//        sum_j w_{i,j} * x_j / (sum_j w_j)</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="comment">//    And neighbour counts for each point.</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="comment">// simultaneously calculates the sum of weighted vector positions (sum w_{i,j} * x_i)</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="comment">// weighted against the inverse sum of weights (1.0 / sum w_{i,j}). Also counts number</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="comment">// of neighours each point has and updates the ellipses group based on minimum</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="comment">// neighbour threshold. Those points which are &quot;included&quot; but which lack sufficient</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="comment">// neighbours will be marked as &quot;not included&quot;.</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    timer.start(<span class="stringliteral">&quot;Compute position weights&quot;</span>);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        WeightPosSumsTransfer&lt;PointDataTreeT&gt;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            transfer(indices, settings, <span class="keywordtype">float</span>(vs), manager, settings.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#aa6e12ee62c3d8342922237cb08a8a6ae">interrupter</a>);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        points::rasterize&lt;PointDataGridT, decltype(transfer)&gt; (points, transfer);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    timer.stop();</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceopenvdb_1_1v12__1_1_1util.html#a7783bf79cc10a02b50848680938e1a74">util::wasInterrupted</a>(settings.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#aa6e12ee62c3d8342922237cb08a8a6ae">interrupter</a>)) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="comment">// 5) Principal axes define the rotation matrix of the ellipsoid.</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="comment">//    Calculates covariance matrices given weighted sums of positions and</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <span class="comment">//    sums of weights per-particle</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    timer.start(<span class="stringliteral">&quot;Compute covariance matrices&quot;</span>);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        CovarianceTransfer&lt;PointDataTreeT&gt;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            transfer(indices, settings, <span class="keywordtype">float</span>(vs), manager, settings.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#aa6e12ee62c3d8342922237cb08a8a6ae">interrupter</a>);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        points::rasterize&lt;PointDataGridT, decltype(transfer)&gt;(points, transfer);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    timer.stop();</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceopenvdb_1_1v12__1_1_1util.html#a7783bf79cc10a02b50848680938e1a74">util::wasInterrupted</a>(settings.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#aa6e12ee62c3d8342922237cb08a8a6ae">interrupter</a>)) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="comment">// 6) radii stretches are given by the scaled singular values. Decompose</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="comment">//    the covariance matrix into its principal axes and their lengths</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    timer.start(<span class="stringliteral">&quot;Decompose covariance matrices&quot;</span>);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    manager.foreach([&amp;](LeafNodeT&amp; leafnode, <span class="keywordtype">size_t</span>)</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1AttributeWriteHandle.html">AttributeWriteHandle&lt;Vec3f, NullCodec&gt;</a> stretchHandle(leafnode.attributeArray(strIdx));</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1AttributeWriteHandle.html">AttributeWriteHandle&lt;math::Mat3s, NullCodec&gt;</a> rotHandle(leafnode.attributeArray(rotIdx));</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1GroupHandle.html">GroupHandle</a> ellipsesGroupHandle(leafnode.groupHandle(ellipsesIdx));</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> idx = 0; idx &lt; stretchHandle.size(); ++idx) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            <span class="keywordflow">if</span> (!ellipsesGroupHandle.get(idx)) {</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                rotHandle.set(idx, math::Mat3s::identity());</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <span class="comment">// get singular values of the covariance matrix</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            <a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Mat3.html">math::Mat3s</a> u;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            <a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#ae60b991a87c83e25ec51e0576209be11">Vec3s</a> sigma;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a59dbbaecb7b917744a0f177dc5cf9085">decomposeSymmetricMatrix</a>(rotHandle.get(idx), u, sigma);</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            <span class="comment">// fix sigma values, the principal lengths</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            <span class="keyword">auto</span> maxs = sigma[0] * settings.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#a367d6d42a69e5b5a743c0e37eb258041">allowedAnisotropyRatio</a>;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            sigma[1] = <a class="code" href="namespaceopenvdb_1_1v12__1_1_1tools_1_1composite.html#a68b92f45fc81cfd68eee1b92eeb18a2d">std::max</a>(sigma[1], maxs);</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            sigma[2] = <a class="code" href="namespaceopenvdb_1_1v12__1_1_1tools_1_1composite.html#a68b92f45fc81cfd68eee1b92eeb18a2d">std::max</a>(sigma[2], maxs);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="comment">// should only happen if all neighbours are coincident</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            <span class="comment">// @note  The specific tolerance here relates to the normalization</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            <span class="comment">//   of the stetch values in step (7) e.g. s*(1.0/cbrt(s.product())).</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            <span class="comment">//   math::Tolerance&lt;float&gt;::value is 1e-7f, but we have a bit more</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            <span class="comment">//   flexibility here, we can deal with smaller values, common for</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            <span class="comment">//   the case where a point only has one neighbour</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            <span class="comment">// @todo  have to manually construct the tolerance because</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <span class="comment">//   math::Tolerance&lt;Vec3f&gt; resolves to 0.0. fix this in the math lib</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a77a3b2fb4616ec519c8426b4ce517231">math::isApproxZero</a>(sigma, <a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html">Vec3f</a>(1e-11f))) {</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                sigma = <a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html#aa984dc14331a37ea48eb985c3bf75bfc">Vec3f::ones</a>();</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            }</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            stretchHandle.set(idx, sigma);</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            rotHandle.set(idx, u);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        }</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    });</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    timer.stop();</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="comment">// 7) normalise the principal lengths such that the transformation they</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="comment">//    describe &#39;preserves volume&#39; thus becoming the stretch of the ellipsoids</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="comment">// Calculates the average volume change that would occur if applying the</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <span class="comment">// transformations defined by the calculate principal axes and their</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="comment">// lengths using the determinant of the stretch component of the</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="comment">// transformation (given by the sum of the diagonal values) and uses this</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <span class="comment">// value to normalise these lengths such that they are relative to the</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="comment">// identity. This ensures that the transformation preserves volume.</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    timer.start(<span class="stringliteral">&quot;Normalise the principal lengths&quot;</span>);</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    manager.foreach([&amp;](LeafNodeT&amp; leafnode, <span class="keywordtype">size_t</span>)</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    {</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1GroupFilter.html">points::GroupFilter</a> filter(ellipsesIdx);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        filter.<a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1GroupFilter.html#a312df5ba957d9f2ea424d908dd3d6532">reset</a>(leafnode);</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1AttributeWriteHandle.html">AttributeWriteHandle&lt;Vec3f, NullCodec&gt;</a> stretchHandle(leafnode.attributeArray(strIdx));</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> i = 0; i &lt; stretchHandle.size(); ++i)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        {</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;            <span class="keywordflow">if</span> (!filter.<a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1GroupFilter.html#a4e68c00cc85c29bc925a1df8cefde38c">valid</a>(&amp;i)) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            <span class="keyword">const</span> <a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html">Vec3f</a> stretch = stretchHandle.get(i);</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            <a class="code" href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a>(stretch != <a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html#a1a4eed83d1eca7e9dfccab6d32e5a17d">Vec3f::zero</a>());</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">float</span> stretchScale = 1.0f / std::cbrt(stretch.<a class="code" href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html#a08d32ae02d6cd34bad068792258d06a9">product</a>());</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            stretchHandle.set(i, stretchScale * stretch);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        }</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    });</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    timer.stop();</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceopenvdb_1_1v12__1_1_1util.html#a7783bf79cc10a02b50848680938e1a74">util::wasInterrupted</a>(settings.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#aa6e12ee62c3d8342922237cb08a8a6ae">interrupter</a>)) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="comment">// 8) do laplacian position smoothing here as we have the weights already</span><span class="comment"></span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">    ///   calculated (calculates the smoothed kernel origins as described in</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment">    ///   the paper). averagePositions value biases the smoothed positions</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment">    ///   towards the weighted mean positions. 1.0  will use the weighted means</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">    ///   while 0.0 will use the original world-space positions</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment"></span>    timer.start(<span class="stringliteral">&quot;Laplacian smooth positions&quot;</span>);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordflow">if</span> (settings.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#a72c2f538c5058cce1a54962ac4bd03c5">averagePositions</a> &gt; 0.0f)</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    {</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        manager.foreach([&amp;](LeafNodeT&amp; leafnode, <span class="keywordtype">size_t</span>) {</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            <a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1AttributeWriteHandle.html">AttributeWriteHandle&lt;Vec3d, NullCodec&gt;</a> Pws(leafnode.attributeArray(pwsIdx));</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            <a class="code" href="classopenvdb_1_1v12__1_1_1points_1_1AttributeHandle.html">AttributeHandle&lt;WeightedPositionSumT, NullCodec&gt;</a> weightedPosSumHandle(leafnode.constAttributeArray(posSumIndex));</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">Index</a> i = 0; i &lt; Pws.size(); ++i)</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            {</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                <span class="comment">// @note  Technically possible for the weights to be valid</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                <span class="comment">//   _and_ zero.</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="namespaceopenvdb_1_1v12__1_1_1math.html#a77a3b2fb4616ec519c8426b4ce517231">math::isApproxZero</a>(weightedPosSumHandle.get(i),</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                    Vec3d(<a class="code" href="structopenvdb_1_1v12__1_1_1math_1_1Tolerance.html">math::Tolerance&lt;double&gt;::value</a>()))) {</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                    <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                }</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                <span class="keyword">const</span> Vec3d smoothedPosition = (1.0f - settings.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#a72c2f538c5058cce1a54962ac4bd03c5">averagePositions</a>) *</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                    Pws.get(i) + settings.<a class="code" href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#a72c2f538c5058cce1a54962ac4bd03c5">averagePositions</a> * weightedPosSumHandle.get(i);</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                Pws.set(i, smoothedPosition);</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            }</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        });</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    }</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    timer.stop();</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="comment">// Remove temporary attributes</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <a class="code" href="namespaceopenvdb_1_1v12__1_1_1points.html#aaaa22577ec29a353a700c9a3fa03906f">points::dropAttributes</a>(tree, temps);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;}</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;}</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;}</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;}</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="preprocessor">#endif // OPENVDB_POINTS_POINT_PRINCIPAL_COMPONENT_ANALYSIS_IMPL_HAS_BEEN_INCLUDED</span></div><div class="ttc" id="structopenvdb_1_1v12__1_1_1IsSpecializationOf_html"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1IsSpecializationOf.html">openvdb::v12_1::IsSpecializationOf</a></div><div class="ttdoc">Helper metafunction used to determine if the first template parameter is a specialization of the clas...</div><div class="ttdef"><b>Definition:</b> Types.h:263</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_a5233bee6957e3e38f5d72e3f8bc6f8fd"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a5233bee6957e3e38f5d72e3f8bc6f8fd">openvdb::v12_1::points::pca_internal::PcaTransfer::mIndices</a></div><div class="ttdeci">const AttrIndices &amp; mIndices</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:178</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1util_1_1CpuTimer_html"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1util_1_1CpuTimer.html">openvdb::v12_1::util::CpuTimer</a></div><div class="ttdoc">Simple timer for basic profiling. </div><div class="ttdef"><b>Definition:</b> CpuTimer.h:66</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings_html_aa6e12ee62c3d8342922237cb08a8a6ae"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#aa6e12ee62c3d8342922237cb08a8a6ae">openvdb::v12_1::points::PcaSettings::interrupter</a></div><div class="ttdeci">util::NullInterrupter * interrupter</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysis.h:149</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1points_1_1GroupWriteHandle_html"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1points_1_1GroupWriteHandle.html">openvdb::v12_1::points::GroupWriteHandle</a></div><div class="ttdef"><b>Definition:</b> AttributeGroup.h:102</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1VolumeTransfer_html"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1VolumeTransfer.html">openvdb::v12_1::points::VolumeTransfer</a></div><div class="ttdoc">The VolumeTransfer module provides methods to automatically setup and access destination buffers for ...</div><div class="ttdef"><b>Definition:</b> PointTransfer.h:296</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1KeyError_html"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1KeyError.html">openvdb::v12_1::KeyError</a></div><div class="ttdef"><b>Definition:</b> Exceptions.h:59</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer_html_ab49c3d308464b470e74e80f608a72925"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html#ab49c3d308464b470e74e80f608a72925">openvdb::v12_1::points::pca_internal::PcaTimer::start</a></div><div class="ttdeci">void start(const char *msg)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:40</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1math_1_1Mat3_html_af08e6152df053fe8980d55e7ccf607fd"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1math_1_1Mat3.html#af08e6152df053fe8980d55e7ccf607fd">openvdb::v12_1::math::Mat3::setColumns</a></div><div class="ttdeci">void setColumns(const Vec3&lt; T &gt; &amp;v1, const Vec3&lt; T &gt; &amp;v2, const Vec3&lt; T &gt; &amp;v3)</div><div class="ttdoc">Set the columns of this matrix to the vectors v1, v2, v3. </div><div class="ttdef"><b>Definition:</b> Mat3.h:209</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices_html"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html">openvdb::v12_1::points::pca_internal::AttrIndices</a></div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:57</div></div>
<div class="ttc" id="openvdb_2Exceptions_8h_html_a3eec2ef3138c64fc5844490187c1b8d1"><div class="ttname"><a href="openvdb_2Exceptions_8h.html#a3eec2ef3138c64fc5844490187c1b8d1">OPENVDB_THROW</a></div><div class="ttdeci">#define OPENVDB_THROW(exception, message)</div><div class="ttdef"><b>Definition:</b> Exceptions.h:74</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer_html_a36cd9d8d389595554ee3e3fdc5764e50"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a36cd9d8d389595554ee3e3fdc5764e50">openvdb::v12_1::points::pca_internal::WeightPosSumsTransfer::WeightPosSumsTransfer</a></div><div class="ttdeci">WeightPosSumsTransfer(const WeightPosSumsTransfer &amp;other)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:208</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer_html_a50581de5fbd80727b5379ec949b65fe9"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a50581de5fbd80727b5379ec949b65fe9">openvdb::v12_1::points::pca_internal::WeightPosSumsTransfer::initialize</a></div><div class="ttdeci">void initialize(const Coord &amp;origin, const size_t idx, const CoordBBox &amp;bounds)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:214</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_html_a49c172664d07773fe108364eafe82942"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1.html#a49c172664d07773fe108364eafe82942">openvdb::v12_1::initialize</a></div><div class="ttdeci">OPENVDB_IMPORT void initialize()</div><div class="ttdoc">Global registration of native Grid, Transform, Metadata and Point attribute types. Also initializes blosc (if enabled). </div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer_html_ab4f590ac77fe187c9f10ccbf6290e6ea"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html#ab4f590ac77fe187c9f10ccbf6290e6ea">openvdb::v12_1::points::pca_internal::NoTimer::start</a></div><div class="ttdeci">void start(const char *)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:29</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1math_html_a8c76ed0355b788b047abae6370087b71"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1math.html#a8c76ed0355b788b047abae6370087b71">openvdb::v12_1::math::Sqrt</a></div><div class="ttdeci">float Sqrt(float x)</div><div class="ttdoc">Return the square root of a floating-point value. </div><div class="ttdef"><b>Definition:</b> Math.h:761</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_aac50e5d581cbc7be4a5593ffe6a26522"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#aac50e5d581cbc7be4a5593ffe6a26522">openvdb::v12_1::points::pca_internal::PcaTransfer::mSettings</a></div><div class="ttdeci">const PcaSettings &amp; mSettings</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:179</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_a2fda99533133ac94b8a7915660757e7c"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a2fda99533133ac94b8a7915660757e7c">openvdb::v12_1::points::pca_internal::PcaTransfer::startPointLeaf</a></div><div class="ttdeci">bool startPointLeaf(const typename PointDataTreeT::LeafNodeType &amp;leaf)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:166</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_ac97026fa661761a4d56ff6c49aba8ad1"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ac97026fa661761a4d56ff6c49aba8ad1">openvdb::v12_1::points::pca_internal::PcaTransfer::mDxInv</a></div><div class="ttdeci">const Real mDxInv</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:180</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_a998a45a7dbc5a1d5229895f76e49c4e6"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a998a45a7dbc5a1d5229895f76e49c4e6">openvdb::v12_1::points::pca_internal::PcaTransfer::mTargetPosition</a></div><div class="ttdeci">std::unique_ptr&lt; PositionHandleT &gt; mTargetPosition</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:182</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1math_1_1Vec3_html_a1a4eed83d1eca7e9dfccab6d32e5a17d"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html#a1a4eed83d1eca7e9dfccab6d32e5a17d">openvdb::v12_1::math::Vec3::zero</a></div><div class="ttdeci">static Vec3&lt; T &gt; zero()</div><div class="ttdoc">Predefined constants, e.g. Vec3d v = Vec3d::xNegAxis();. </div><div class="ttdef"><b>Definition:</b> Vec3.h:467</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_html_a1a68fb76e3d6897fa878760b6bcbda7a"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1.html#a1a68fb76e3d6897fa878760b6bcbda7a">openvdb::v12_1::Index</a></div><div class="ttdeci">Index32 Index</div><div class="ttdef"><b>Definition:</b> Types.h:54</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1points_html_aaaa22577ec29a353a700c9a3fa03906f"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1points.html#aaaa22577ec29a353a700c9a3fa03906f">openvdb::v12_1::points::dropAttributes</a></div><div class="ttdeci">void dropAttributes(PointDataTreeT &amp;tree, const std::vector&lt; size_t &gt; &amp;indices)</div><div class="ttdoc">Drops attributes from the VDB tree. </div><div class="ttdef"><b>Definition:</b> PointAttributeImpl.h:238</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1math_html_a77a3b2fb4616ec519c8426b4ce517231"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1math.html#a77a3b2fb4616ec519c8426b4ce517231">openvdb::v12_1::math::isApproxZero</a></div><div class="ttdeci">bool isApproxZero(const Type &amp;x)</div><div class="ttdoc">Return true if x is equal to zero to within the default floating-point comparison tolerance...</div><div class="ttdef"><b>Definition:</b> Math.h:349</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer_html_af7ccddef0d121d14d6720cb0dd6296aa"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#af7ccddef0d121d14d6720cb0dd6296aa">openvdb::v12_1::points::pca_internal::CovarianceTransfer::rasterizePoints</a></div><div class="ttdeci">void rasterizePoints(const Coord &amp;, const Index start, const Index end, const CoordBBox &amp;bounds)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:377</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_a1c873216cd8998fa684d657246669220"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a1c873216cd8998fa684d657246669220">openvdb::v12_1::points::pca_internal::PcaTransfer::range</a></div><div class="ttdeci">Vec3i range(const Coord &amp;, size_t) const </div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:155</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_a79a005a4082d2b5640fa443033203f2b"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a79a005a4082d2b5640fa443033203f2b">openvdb::v12_1::points::pca_internal::PcaTransfer::mManager</a></div><div class="ttdeci">const tree::LeafManager&lt; PointDataTreeT &gt; &amp; mManager</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:181</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices_html_a2fa6476b9adfe4d6e66b80dbb64b05cc"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#a2fa6476b9adfe4d6e66b80dbb64b05cc">openvdb::v12_1::points::pca_internal::AttrIndices::mPWsIndex</a></div><div class="ttdeci">size_t mPWsIndex</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:62</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings_html_a72c2f538c5058cce1a54962ac4bd03c5"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#a72c2f538c5058cce1a54962ac4bd03c5">openvdb::v12_1::points::PcaSettings::averagePositions</a></div><div class="ttdeci">float averagePositions</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysis.h:147</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer_html_af7ccddef0d121d14d6720cb0dd6296aa"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#af7ccddef0d121d14d6720cb0dd6296aa">openvdb::v12_1::points::pca_internal::WeightPosSumsTransfer::rasterizePoints</a></div><div class="ttdeci">void rasterizePoints(const Coord &amp;, const Index start, const Index end, const CoordBBox &amp;bounds)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:223</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1points_1_1GroupFilter_html"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1points_1_1GroupFilter.html">openvdb::v12_1::points::GroupFilter</a></div><div class="ttdoc">Index filtering on group membership. </div><div class="ttdef"><b>Definition:</b> AttributeGroup.h:135</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1points_1_1AttributeWriteHandle_html"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1points_1_1AttributeWriteHandle.html">openvdb::v12_1::points::AttributeWriteHandle</a></div><div class="ttdoc">Write-able version of AttributeHandle. </div><div class="ttdef"><b>Definition:</b> AttributeArray.h:831</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices_html_ab656e3a99355a7187c65c98a1390e558"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#ab656e3a99355a7187c65c98a1390e558">openvdb::v12_1::points::pca_internal::AttrIndices::mEllipsesGroupIndex</a></div><div class="ttdeci">GroupIndexT mEllipsesGroupIndex</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:63</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1points_html_a6df5f0462ae9d328e4987971cda4c7ee"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1points.html#a6df5f0462ae9d328e4987971cda4c7ee">openvdb::v12_1::points::appendGroup</a></div><div class="ttdeci">void appendGroup(PointDataTreeT &amp;tree, const Name &amp;group)</div><div class="ttdoc">Appends a new empty group to the VDB tree. </div><div class="ttdef"><b>Definition:</b> PointGroupImpl.h:209</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings_html_ad600459e92dde7f0856f77c19d8c5af0"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#ad600459e92dde7f0856f77c19d8c5af0">openvdb::v12_1::points::PcaSettings::nonAnisotropicStretch</a></div><div class="ttdeci">float nonAnisotropicStretch</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysis.h:99</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1math_html_adf6e1d7d066bb09da957cc89f2b3ceb2"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1math.html#adf6e1d7d066bb09da957cc89f2b3ceb2">openvdb::v12_1::math::Vec3i</a></div><div class="ttdeci">Vec3&lt; int32_t &gt; Vec3i</div><div class="ttdef"><b>Definition:</b> Vec3.h:662</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer_html_a8964920060c97fa9960e976160e532e9"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html#a8964920060c97fa9960e976160e532e9">openvdb::v12_1::points::pca_internal::PcaTimer::PcaTimer</a></div><div class="ttdeci">PcaTimer(util::NullInterrupter *const interrupt)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:37</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal_html_a18f7ed305c5f923b88fdd66718cbb679"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a18f7ed305c5f923b88fdd66718cbb679">openvdb::v12_1::points::pca_internal::WeightSumT</a></div><div class="ttdeci">double WeightSumT</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:53</div></div>
<div class="ttc" id="Platform_8h_html_aa7a931484d0bf4c15d597386de0ec0f6"><div class="ttname"><a href="Platform_8h.html#aa7a931484d0bf4c15d597386de0ec0f6">OPENVDB_UNLIKELY</a></div><div class="ttdeci">#define OPENVDB_UNLIKELY(x)</div><div class="ttdef"><b>Definition:</b> Platform.h:92</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer_html_a9913a5174660f96cddb1f191b6e56769"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a9913a5174660f96cddb1f191b6e56769">openvdb::v12_1::points::pca_internal::WeightPosSumsTransfer::WeightPosSumsTransfer</a></div><div class="ttdeci">WeightPosSumsTransfer(const AttrIndices &amp;indices, const PcaSettings &amp;settings, const Real vs, tree::LeafManager&lt; PointDataTreeT &gt; &amp;manager, util::NullInterrupter *interrupt)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:198</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1util_1_1NullInterrupter_html"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1util_1_1NullInterrupter.html">openvdb::v12_1::util::NullInterrupter</a></div><div class="ttdoc">Base class for interrupters. </div><div class="ttdef"><b>Definition:</b> NullInterrupter.h:25</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer_html"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html">openvdb::v12_1::points::pca_internal::NoTimer</a></div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:28</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_a4366dd3b0170576a66f1d86d2658fe62"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a4366dd3b0170576a66f1d86d2658fe62">openvdb::v12_1::points::pca_internal::PcaTransfer::searchRadius</a></div><div class="ttdeci">float searchRadius() const </div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:150</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1points_1_1AttributeHandle_html"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1points_1_1AttributeHandle.html">openvdb::v12_1::points::AttributeHandle</a></div><div class="ttdef"><b>Definition:</b> AttributeArray.h:763</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1math_1_1Vec3_html_af59136c0fb2c6ccc665bbc1c1f19a751"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html#af59136c0fb2c6ccc665bbc1c1f19a751">openvdb::v12_1::math::Vec3::x</a></div><div class="ttdeci">T &amp; x()</div><div class="ttdoc">Reference to the component, e.g. v.x() = 4.5f;. </div><div class="ttdef"><b>Definition:</b> Vec3.h:86</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1points_html_a74fa733452dea2d0ee1d99c9583fd30d"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1points.html#a74fa733452dea2d0ee1d99c9583fd30d">openvdb::v12_1::points::pca</a></div><div class="ttdeci">void pca(PointDataGridT &amp;points, const PcaSettings &amp;settings, const PcaAttributes &amp;attrs)</div><div class="ttdoc">Calculate ellipsoid transformations from the local point distributions as described in Yu and Turk&amp;#39;s ...</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:548</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings_html"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html">openvdb::v12_1::points::PcaSettings</a></div><div class="ttdoc">Various settings for the neighborhood analysis of point distributions. </div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysis.h:66</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1points_1_1GroupHandle_html_a57b4be157b07a61dd2236638e5288d88"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1points_1_1GroupHandle.html#a57b4be157b07a61dd2236638e5288d88">openvdb::v12_1::points::GroupHandle::UniquePtr</a></div><div class="ttdeci">std::unique_ptr&lt; GroupHandle &gt; UniquePtr</div><div class="ttdef"><b>Definition:</b> AttributeGroup.h:77</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1tree_1_1LeafManager_html"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1tree_1_1LeafManager.html">openvdb::v12_1::tree::LeafManager&lt; PointDataTreeT &gt;</a></div></div>
<div class="ttc" id="Assert_8h_html_a9b706542bb9f44d82cd273d74e722c35"><div class="ttname"><a href="Assert_8h.html#a9b706542bb9f44d82cd273d74e722c35">OPENVDB_ASSERT</a></div><div class="ttdeci">#define OPENVDB_ASSERT(X)</div><div class="ttdef"><b>Definition:</b> Assert.h:41</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1math_1_1Mat3_html_a0be7ef8d3fb41427f942546f4745e5ac"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1math_1_1Mat3.html#a0be7ef8d3fb41427f942546f4745e5ac">openvdb::v12_1::math::Mat3::col</a></div><div class="ttdeci">Vec3&lt; T &gt; col(int j) const </div><div class="ttdoc">Get jth column, e.g. Vec3d v = m.col(0);. </div><div class="ttdef"><b>Definition:</b> Mat3.h:168</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_a813e941d4fd2616e1d8909d7cc551dc3"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a813e941d4fd2616e1d8909d7cc551dc3">openvdb::v12_1::points::pca_internal::PcaTransfer::maxTargetPointsPerVoxel</a></div><div class="ttdeci">size_t maxTargetPointsPerVoxel() const </div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:153</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_ac75c6baec61b7993e73761d50aa5c1a2"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ac75c6baec61b7993e73761d50aa5c1a2">openvdb::v12_1::points::pca_internal::PcaTransfer::LeafNodeType</a></div><div class="ttdeci">typename PointDataTreeT::LeafNodeType LeafNodeType</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:100</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1points_1_1GroupHandle_html"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1points_1_1GroupHandle.html">openvdb::v12_1::points::GroupHandle</a></div><div class="ttdef"><b>Definition:</b> AttributeGroup.h:73</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices_html_a96a4b8f632b5380b51aedc976d6bf952"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#a96a4b8f632b5380b51aedc976d6bf952">openvdb::v12_1::points::pca_internal::AttrIndices::mWeightSumIndex</a></div><div class="ttdeci">size_t mWeightSumIndex</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:60</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_a483ccde36f43eefafb7bf7aa794ce9fd"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a483ccde36f43eefafb7bf7aa794ce9fd">openvdb::v12_1::points::pca_internal::PcaTransfer::range</a></div><div class="ttdeci">Vec3i range() const </div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:156</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1math_html_a92bf3f50c6ca5ecbca05b22b53768d7f"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1math.html#a92bf3f50c6ca5ecbca05b22b53768d7f">openvdb::v12_1::math::Pow2</a></div><div class="ttdeci">Type Pow2(Type x)</div><div class="ttdoc">Return x2. </div><div class="ttdef"><b>Definition:</b> Math.h:548</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1math_1_1Tolerance_html"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1math_1_1Tolerance.html">openvdb::v12_1::math::Tolerance</a></div><div class="ttdoc">Tolerance for floating-point comparison. </div><div class="ttdef"><b>Definition:</b> Math.h:148</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer_html_aa949854ab9c2a1c71b223cd08d4e1166"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#aa949854ab9c2a1c71b223cd08d4e1166">openvdb::v12_1::points::pca_internal::CovarianceTransfer::CovarianceTransfer</a></div><div class="ttdeci">CovarianceTransfer(const CovarianceTransfer &amp;other)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:361</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal_html_a3f32fa658e09e0952c3763711968293a"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a3f32fa658e09e0952c3763711968293a">openvdb::v12_1::points::pca_internal::initPcaArrayAttribute</a></div><div class="ttdeci">T * initPcaArrayAttribute(LeafNodeT &amp;leaf, const size_t idx, const bool fill=true)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:67</div></div>
<div class="ttc" id="namespaceopenvdb_html"><div class="ttname"><a href="namespaceopenvdb.html">openvdb</a></div><div class="ttdef"><b>Definition:</b> Exceptions.h:13</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1math_html_ac41d20efb3b21495b99555a27205127a"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1math.html#ac41d20efb3b21495b99555a27205127a">openvdb::v12_1::math::Round</a></div><div class="ttdeci">float Round(float x)</div><div class="ttdoc">Return x rounded to the nearest integer. </div><div class="ttdef"><b>Definition:</b> Math.h:819</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal_html_a39a6b84fbe901cd11124db01ed852617"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a39a6b84fbe901cd11124db01ed852617">openvdb::v12_1::points::pca_internal::GroupIndexT</a></div><div class="ttdeci">points::AttributeSet::Descriptor::GroupIndex GroupIndexT</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:55</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices_html_a48cfd91afb5821f6fc06c08519a88c0d"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#a48cfd91afb5821f6fc06c08519a88c0d">openvdb::v12_1::points::pca_internal::AttrIndices::mPosSumIndex</a></div><div class="ttdeci">size_t mPosSumIndex</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:59</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1math_1_1Vec3_html"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html">openvdb::v12_1::math::Vec3</a></div><div class="ttdef"><b>Definition:</b> Mat.h:165</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer_html"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html">openvdb::v12_1::points::pca_internal::CovarianceTransfer</a></div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:342</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal_html_a6d253f8e6189aafd7ce00d3bb20bfd3b"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a6d253f8e6189aafd7ce00d3bb20bfd3b">openvdb::v12_1::points::pca_internal::descendingOrder</a></div><div class="ttdeci">Vec3i descendingOrder(math::Vec3&lt; Scalar &gt; &amp;vector)</div><div class="ttdoc">Sort a vector into descending order and output a vector of the resulting order. </div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:497</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes_html_a2df625cb603c09330b44d1328efdbb50"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes.html#a2df625cb603c09330b44d1328efdbb50">openvdb::v12_1::points::PcaAttributes::ellipses</a></div><div class="ttdeci">std::string ellipses</div><div class="ttdoc">A point group to create that represents points which have valid ellipsoidal neighborhood. Points outside of this group will have their stretch and rotation attributes set to describe a canonical sphere. Note however that all points, regardless of this groups membership flag, will still contribute to their neighbours and may have their world space position deformed in relation to their neighboring points. </div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysis.h:185</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal_html_aef0dd7cd7a370c4e165eb525ba4293e4"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#aef0dd7cd7a370c4e165eb525ba4293e4">openvdb::v12_1::points::pca_internal::WeightedPositionSumT</a></div><div class="ttdeci">Vec3d WeightedPositionSumT</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:54</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer_html_ab69fbad684042da90c1731572ef3739a"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html#ab69fbad684042da90c1731572ef3739a">openvdb::v12_1::points::pca_internal::PcaTimer::mInterrupt</a></div><div class="ttdeci">util::NullInterrupter *const mInterrupt</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:50</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_a0d421a9a9585b892f618012d3fb2bc6d"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a0d421a9a9585b892f618012d3fb2bc6d">openvdb::v12_1::points::pca_internal::PcaTransfer::PcaTransfer</a></div><div class="ttdeci">PcaTransfer(const AttrIndices &amp;indices, const PcaSettings &amp;settings, const Real vs, tree::LeafManager&lt; PointDataTreeT &gt; &amp;manager, util::NullInterrupter *interrupt)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:105</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal_html_a59dbbaecb7b917744a0f177dc5cf9085"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1points_1_1pca__internal.html#a59dbbaecb7b917744a0f177dc5cf9085">openvdb::v12_1::points::pca_internal::decomposeSymmetricMatrix</a></div><div class="ttdeci">bool decomposeSymmetricMatrix(const math::Mat3&lt; Scalar &gt; &amp;mat, math::Mat3&lt; Scalar &gt; &amp;U, math::Vec3&lt; Scalar &gt; &amp;sigma)</div><div class="ttdoc">Decomposes a symmetric matrix into its eigenvalues and a rotation matrix of eigenvectors. Note that if mat is positive-definite, this will be equivalent to a singular value decomposition where V = U. </div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:524</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_html_a4b04262b81aa7d31eb5d2f607e2a35de"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1.html#a4b04262b81aa7d31eb5d2f607e2a35de">openvdb::v12_1::Real</a></div><div class="ttdeci">double Real</div><div class="ttdef"><b>Definition:</b> Types.h:60</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1util_html_a7783bf79cc10a02b50848680938e1a74"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1util.html#a7783bf79cc10a02b50848680938e1a74">openvdb::v12_1::util::wasInterrupted</a></div><div class="ttdeci">bool wasInterrupted(T *i, int percent=-1)</div><div class="ttdef"><b>Definition:</b> NullInterrupter.h:49</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1points_html_a1866ee320dd051901bb7f4f49e155cee"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1points.html#a1866ee320dd051901bb7f4f49e155cee">openvdb::v12_1::points::setGroup</a></div><div class="ttdeci">void setGroup(PointDataTreeT &amp;tree, const PointIndexTreeT &amp;indexTree, const std::vector&lt; short &gt; &amp;membership, const Name &amp;group, const bool remove=false)</div><div class="ttdoc">Sets group membership from a PointIndexTree-ordered vector. </div><div class="ttdef"><b>Definition:</b> PointGroupImpl.h:438</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_a3130b08485d61bf9b9d4052b3e39d000"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#a3130b08485d61bf9b9d4052b3e39d000">openvdb::v12_1::points::pca_internal::PcaTransfer::maxSourcePointsPerVoxel</a></div><div class="ttdeci">size_t maxSourcePointsPerVoxel() const </div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:152</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer_html_a8c528baf37154d347366083f0f816846"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html#a8c528baf37154d347366083f0f816846">openvdb::v12_1::points::pca_internal::PcaTimer::stop</a></div><div class="ttdeci">void stop()</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:45</div></div>
<div class="ttc" id="openvdb_2openvdb_2util_2CpuTimer_8h_html"><div class="ttname"><a href="openvdb_2openvdb_2util_2CpuTimer_8h.html">CpuTimer.h</a></div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html">openvdb::v12_1::points::pca_internal::PcaTransfer</a></div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:95</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_ab3a6665da196186afeebde1f5c57fe48"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ab3a6665da196186afeebde1f5c57fe48">openvdb::v12_1::points::pca_internal::PcaTransfer::PcaTransfer</a></div><div class="ttdeci">PcaTransfer(const PcaTransfer &amp;other)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:122</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1InterruptableTransfer_html"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1InterruptableTransfer.html">openvdb::v12_1::points::InterruptableTransfer</a></div><div class="ttdoc">InterruptableTransfer module, when derived from allows for schemes to callback into a interrupter...</div><div class="ttdef"><b>Definition:</b> PointTransfer.h:230</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_acd866270b26d80b767c92f50e7be5169"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#acd866270b26d80b767c92f50e7be5169">openvdb::v12_1::points::pca_internal::PcaTransfer::endPointLeaf</a></div><div class="ttdeci">bool endPointLeaf(const typename PointDataTreeT::LeafNodeType &amp;)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:175</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes_html"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes.html">openvdb::v12_1::points::PcaAttributes</a></div><div class="ttdoc">The persistent attributes created by the PCA methods. </div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysis.h:155</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices_html_a0abe803363d9a241051a65f348672c2e"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1AttrIndices.html#a0abe803363d9a241051a65f348672c2e">openvdb::v12_1::points::pca_internal::AttrIndices::mCovMatrixIndex</a></div><div class="ttdeci">size_t mCovMatrixIndex</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:61</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1points_1_1GroupFilter_html_a312df5ba957d9f2ea424d908dd3d6532"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1points_1_1GroupFilter.html#a312df5ba957d9f2ea424d908dd3d6532">openvdb::v12_1::points::GroupFilter::reset</a></div><div class="ttdeci">void reset(const LeafT &amp;leaf)</div><div class="ttdef"><b>Definition:</b> AttributeGroup.h:151</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_afd0505e726ff74f5dfd542a322e1e17b"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#afd0505e726ff74f5dfd542a322e1e17b">openvdb::v12_1::points::pca_internal::PcaTransfer::initialize</a></div><div class="ttdeci">LeafNodeType * initialize(const Coord &amp;origin, const size_t idx, const CoordBBox &amp;bounds)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:158</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes_html_a22dd239b885254df215c9f4d613102a5"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes.html#a22dd239b885254df215c9f4d613102a5">openvdb::v12_1::points::PcaAttributes::positionWS</a></div><div class="ttdeci">std::string positionWS</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysis.h:176</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes_html_a713f968f2be98263546ec2b16f184f78"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes.html#a713f968f2be98263546ec2b16f184f78">openvdb::v12_1::points::PcaAttributes::stretch</a></div><div class="ttdeci">std::string stretch</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysis.h:161</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1math_html_a3d91050fd959cebedf9a76ffaf59b29d"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1math.html#a3d91050fd959cebedf9a76ffaf59b29d">openvdb::v12_1::math::Pow3</a></div><div class="ttdeci">Type Pow3(Type x)</div><div class="ttdoc">Return x3. </div><div class="ttdef"><b>Definition:</b> Math.h:552</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer_html_a066c0cf69ae4e5fb6d2271705422ebef"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html#a066c0cf69ae4e5fb6d2271705422ebef">openvdb::v12_1::points::pca_internal::WeightPosSumsTransfer::finalize</a></div><div class="ttdeci">bool finalize(const Coord &amp;, size_t idx)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:305</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_ae2e7edab3832bc4e54e9268b5723957c"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#ae2e7edab3832bc4e54e9268b5723957c">openvdb::v12_1::points::pca_internal::PcaTransfer::mSourcePosition</a></div><div class="ttdeci">std::unique_ptr&lt; PositionHandleT &gt; mSourcePosition</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:183</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1tree_1_1LeafManager_html_a932dc28aa53e3961b2c4f8b3ff4c7242"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1tree_1_1LeafManager.html#a932dc28aa53e3961b2c4f8b3ff4c7242">openvdb::v12_1::tree::LeafManager::tree</a></div><div class="ttdeci">const TreeType &amp; tree() const </div><div class="ttdoc">Return a const reference to tree associated with this manager. </div><div class="ttdef"><b>Definition:</b> LeafManager.h:303</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1math_html_a25bd68ea05f64fc7e9fba6cb76eab539"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1math.html#a25bd68ea05f64fc7e9fba6cb76eab539">openvdb::v12_1::math::diagonalizeSymmetricMatrix</a></div><div class="ttdeci">bool diagonalizeSymmetricMatrix(const Mat3&lt; T &gt; &amp;input, Mat3&lt; T &gt; &amp;Q, Vec3&lt; T &gt; &amp;D, unsigned int MAX_ITERATIONS=250)</div><div class="ttdoc">Use Jacobi iterations to decompose a symmetric 3x3 matrix (diagonalize and compute eigenvectors) ...</div><div class="ttdef"><b>Definition:</b> Mat3.h:736</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings_html_a367d6d42a69e5b5a743c0e37eb258041"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1PcaSettings.html#a367d6d42a69e5b5a743c0e37eb258041">openvdb::v12_1::points::PcaSettings::allowedAnisotropyRatio</a></div><div class="ttdeci">float allowedAnisotropyRatio</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysis.h:94</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer_html_a8c528baf37154d347366083f0f816846"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1NoTimer.html#a8c528baf37154d347366083f0f816846">openvdb::v12_1::points::pca_internal::NoTimer::stop</a></div><div class="ttdeci">void stop()</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:30</div></div>
<div class="ttc" id="version_8h_8in_html_a00be3835cb8ad1ded8abd821fad20fc0"><div class="ttname"><a href="version_8h_8in.html#a00be3835cb8ad1ded8abd821fad20fc0">OPENVDB_VERSION_NAME</a></div><div class="ttdeci">#define OPENVDB_VERSION_NAME</div><div class="ttdoc">The version namespace name for this library version. </div><div class="ttdef"><b>Definition:</b> version.h.in:121</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes_html_a020a5ed16757011c234ad22ec7d3e20b"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1PcaAttributes.html#a020a5ed16757011c234ad22ec7d3e20b">openvdb::v12_1::points::PcaAttributes::rotation</a></div><div class="ttdeci">std::string rotation</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysis.h:167</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer_html"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTimer.html">openvdb::v12_1::points::pca_internal::PcaTimer</a></div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:35</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1math_1_1Vec3_html_aa984dc14331a37ea48eb985c3bf75bfc"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html#aa984dc14331a37ea48eb985c3bf75bfc">openvdb::v12_1::math::Vec3::ones</a></div><div class="ttdeci">static Vec3&lt; T &gt; ones()</div><div class="ttdef"><b>Definition:</b> Vec3.h:468</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer_html_aa82227fd25dcfb0f1433d99e7060fb9c"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1PcaTransfer.html#aa82227fd25dcfb0f1433d99e7060fb9c">openvdb::v12_1::points::pca_internal::PcaTransfer::neighbourThreshold</a></div><div class="ttdeci">size_t neighbourThreshold() const </div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:151</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer_html_aa3c24766724130675ea92e3b062345ab"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#aa3c24766724130675ea92e3b062345ab">openvdb::v12_1::points::pca_internal::CovarianceTransfer::CovarianceTransfer</a></div><div class="ttdeci">CovarianceTransfer(const AttrIndices &amp;indices, const PcaSettings &amp;settings, const Real vs, tree::LeafManager&lt; PointDataTreeT &gt; &amp;manager, util::NullInterrupter *interrupt)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:350</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer_html"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1WeightPosSumsTransfer.html">openvdb::v12_1::points::pca_internal::WeightPosSumsTransfer</a></div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:190</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1math_html_ae60b991a87c83e25ec51e0576209be11"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1math.html#ae60b991a87c83e25ec51e0576209be11">openvdb::v12_1::math::Vec3s</a></div><div class="ttdeci">Vec3&lt; float &gt; Vec3s</div><div class="ttdef"><b>Definition:</b> Vec3.h:664</div></div>
<div class="ttc" id="namespaceopenvdb_1_1v12__1_1_1tools_1_1composite_html_a68b92f45fc81cfd68eee1b92eeb18a2d"><div class="ttname"><a href="namespaceopenvdb_1_1v12__1_1_1tools_1_1composite.html#a68b92f45fc81cfd68eee1b92eeb18a2d">openvdb::v12_1::tools::composite::max</a></div><div class="ttdeci">const std::enable_if&lt;!VecTraits&lt; T &gt;::IsVec, T &gt;::type &amp; max(const T &amp;a, const T &amp;b)</div><div class="ttdef"><b>Definition:</b> Composite.h:110</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1points_1_1GroupFilter_html_a4e68c00cc85c29bc925a1df8cefde38c"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1points_1_1GroupFilter.html#a4e68c00cc85c29bc925a1df8cefde38c">openvdb::v12_1::points::GroupFilter::valid</a></div><div class="ttdeci">bool valid(const IterT &amp;iter) const </div><div class="ttdef"><b>Definition:</b> AttributeGroup.h:156</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer_html_a6908fe788ccb493a3e864ff725b95b21"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#a6908fe788ccb493a3e864ff725b95b21">openvdb::v12_1::points::pca_internal::CovarianceTransfer::finalize</a></div><div class="ttdeci">bool finalize(const Coord &amp;, size_t)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:483</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1math_1_1Mat3_html"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1math_1_1Mat3.html">openvdb::v12_1::math::Mat3</a></div><div class="ttdoc">3x3 matrix class. </div><div class="ttdef"><b>Definition:</b> Mat3.h:28</div></div>
<div class="ttc" id="classopenvdb_1_1v12__1_1_1math_1_1Vec3_html_a08d32ae02d6cd34bad068792258d06a9"><div class="ttname"><a href="classopenvdb_1_1v12__1_1_1math_1_1Vec3.html#a08d32ae02d6cd34bad068792258d06a9">openvdb::v12_1::math::Vec3::product</a></div><div class="ttdeci">T product() const </div><div class="ttdoc">Return the product of all the vector components. </div><div class="ttdef"><b>Definition:</b> Vec3.h:357</div></div>
<div class="ttc" id="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer_html_a50581de5fbd80727b5379ec949b65fe9"><div class="ttname"><a href="structopenvdb_1_1v12__1_1_1points_1_1pca__internal_1_1CovarianceTransfer.html#a50581de5fbd80727b5379ec949b65fe9">openvdb::v12_1::points::pca_internal::CovarianceTransfer::initialize</a></div><div class="ttdeci">void initialize(const Coord &amp;origin, const size_t idx, const CoordBBox &amp;bounds)</div><div class="ttdef"><b>Definition:</b> PrincipalComponentAnalysisImpl.h:368</div></div>
<div class="ttc" id="version_8h_8in_html_a2dde157791cd7558cdf886489256ba14"><div class="ttname"><a href="version_8h_8in.html#a2dde157791cd7558cdf886489256ba14">OPENVDB_USE_VERSION_NAMESPACE</a></div><div class="ttdeci">#define OPENVDB_USE_VERSION_NAMESPACE</div><div class="ttdef"><b>Definition:</b> version.h.in:218</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
